---
stages:
  - build
  - configuration

build-pnl-dependencies-job:
  stage: build
  tags: [pnl]
  script:
    - cpanm -L local -nq --installdeps .
    - mkdir -p             deploy
    - cp -av bin/          deploy/
    - cp -av lib/          deploy/
    - cp -av public/       deploy/
    - cp -av views/        deploy/
    - cp -av environments/ deploy/
    - cp -a  local/        deploy/
    - cp -v  config.yml    deploy/
  cache:
    key: pnl_deps
    paths:
      - local/
  artifacts:
    paths:
      - deploy/

merge-pnl-config-job:
  stage: configuration
  needs:
    -
      job: build-pnl-dependencies-job
      artifacts: true
#    -
#      project: sysadmin/ztreet-configs
#      job: build-pnl-artifacts-job
#      ref: main
#      artifacts: true
  tags: [pnl]
  artifacts:
    paths:
      - deploy/
#  script:
#    - cp -av pnlconfig/. deploy/
